<template>

  <div id="app">
    <div id='logo'>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 525.45 96.54">
      <path d="M0,0H0V96.54H169V0H0ZM139.73,34.24a3.32,3.32,0,1,1-3.31-3.35,3.33,3.33,0,0,1,3.31,3.35m-29.6,0a3.32,3.32,0,1,1-3.32-3.35,3.34,3.34,0,0,1,3.32,3.35M7.65,88.82V68.22H36.52A6.33,6.33,0,0,0,41.6,70.8a6.44,6.44,0,0,0,0-12.87,6.33,6.33,0,0,0-5.08,2.58H7.65V7.72h65.6V30.38H46.68A6.34,6.34,0,0,0,41.6,27.8a6.44,6.44,0,0,0,0,12.87,6.35,6.35,0,0,0,5.08-2.57H73.25V88.82H7.65ZM38.29,64.36a3.32,3.32,0,1,1,3.31,3.35,3.33,3.33,0,0,1-3.31-3.35m6.63-30.12a3.32,3.32,0,1,1-3.32-3.35,3.34,3.34,0,0,1,3.32,3.35m73.38,30.12a3.32,3.32,0,1,1,3.31,3.35,3.33,3.33,0,0,1-3.31-3.35m43,24.46H125.44V69.48a6.38,6.38,0,1,0-7.66,0V88.82H80.9V7.72H103v21.4a6.38,6.38,0,1,0,7.65,0V7.72h21.94v21.4a6.38,6.38,0,1,0,7.66,0V7.72h21.06v81.1Z" transform="translate(0 0)" class="cls-1 mobile-visible"></path> <path d="M214.49,62.07l4.88-6.84a18.53,18.53,0,0,0,13.43,5.7c4.94,0,7.35-2.28,7.35-4.69,0-7.48-24.33-2.34-24.33-18.25,0-7,6.08-12.86,16-12.86,6.72,0,12.29,2,16.47,5.89l-5,6.59A18.15,18.15,0,0,0,231,33c-3.87,0-6,1.71-6,4.25,0,6.72,24.26,2.22,24.26,18,0,7.73-5.51,13.56-16.92,13.56C224.25,68.78,218.42,66.06,214.49,62.07Z" transform="translate(0 0)" class="cls-1"></path> <path d="M253.2,52.69c0-9.38,6.78-16,16.22-16,6.27,0,10.07,2.72,12.1,5.51l-5.26,4.94a7.42,7.42,0,0,0-6.46-3.29c-4.88,0-8.3,3.55-8.3,8.87s3.42,8.93,8.3,8.93a7.72,7.72,0,0,0,6.46-3.29l5.26,4.88c-2,2.85-5.83,5.58-12.1,5.58C260,68.78,253.2,62.13,253.2,52.69Z" transform="translate(0 0)" class="cls-1"></path> <path d="M305,68V64.85c-2.09,2.47-5.7,3.93-9.69,3.93-4.88,0-10.64-3.29-10.64-10.14,0-7.16,5.77-9.88,10.64-9.88,4.05,0,7.67,1.33,9.69,3.74V48.38c0-3.1-2.66-5.13-6.72-5.13a12.87,12.87,0,0,0-8.93,3.61l-3-5.39a20.07,20.07,0,0,1,13.37-4.81c7,0,13.37,2.79,13.37,11.59V68h-8Zm0-7.35v-3.8c-1.33-1.77-3.87-2.66-6.46-2.66-3.17,0-5.77,1.65-5.77,4.63s2.6,4.5,5.77,4.5C301.16,63.33,303.7,62.45,305,60.67Z" transform="translate(0 0)" class="cls-1"></path> <path d="M341.65,68V49.52c0-4.24-2.22-5.7-5.64-5.7a8.72,8.72,0,0,0-7,3.61V68h-8V37.42h8v4a14,14,0,0,1,10.71-4.75c6.72,0,9.95,3.8,9.95,9.76V68h-8Z" transform="translate(0 0)" class="cls-1"></path> <path d="M378.65,68V64.1a11.88,11.88,0,0,1-9.44,4.69c-7.73,0-13.56-5.83-13.56-16,0-10,5.77-16.09,13.56-16.09a11.79,11.79,0,0,1,9.44,4.69V25.77h8.11V68h-8.11Zm0-9.88V47.31a8.76,8.76,0,0,0-7-3.48c-4.56,0-7.73,3.61-7.73,8.93s3.17,8.87,7.73,8.87A8.76,8.76,0,0,0,378.65,58.14Z" transform="translate(0 0)" class="cls-1"></path> <path d="M393.92,29.31a4.81,4.81,0,1,1,4.81,4.81A4.85,4.85,0,0,1,393.92,29.31ZM394.75,68V37.42h8V68h-8Z" transform="translate(0 0)" class="cls-1"></path> <path d="M437.64,68l-6.46-20.84L424.72,68H416.1l-9.31-30.6h8.36L420.85,58l6.72-20.59h7.16L441.44,58l5.7-20.59h8.36L446.19,68h-8.55Z" transform="translate(0 0)" class="cls-1"></path> <path d="M457.54,52.69c0-8.87,6.53-16,15.84-16,9.12,0,15.33,6.84,15.33,16.85v1.77H466c0.51,3.86,3.61,7.1,8.81,7.1a13,13,0,0,0,8.17-3l3.55,5.2c-3,2.79-7.86,4.24-12.61,4.24C464.57,68.78,457.54,62.51,457.54,52.69Zm15.84-9.63c-5,0-7.16,3.74-7.54,6.78h15.08A7.09,7.09,0,0,0,473.38,43.06Z" transform="translate(0 0)" class="cls-1"></path> <path d="M494.41,68V25.77h8V41.35a11.79,11.79,0,0,1,9.44-4.69c7.79,0,13.56,6.08,13.56,16.09,0,10.2-5.83,16-13.56,16a11.88,11.88,0,0,1-9.44-4.69V68h-8Zm15-6.4c4.69,0,7.79-3.55,7.79-8.87s-3.1-8.93-7.79-8.93a8.88,8.88,0,0,0-6.91,3.55V58.2A9,9,0,0,0,509.36,61.62Z" transform="translate(0 0)" class="cls-1"></path></svg>
    </div>    
    <WelcomeView v-if="isOnWelcomeScreen" id='view-1' class='page' @jobSelected='onJobSeclected' msg="Welcome to Your Vue.js App"/>
    <PersonalInfoView v-if="isOnPersoScreen" @userInfosUpdated='userInfoCompleted'  id='view-2' class='page' />
    <Quiz v-if="isOnQuizScreen" id='view-3' @quizdone='onQuizDone' class='page' />
    <Result v-if='isOnResultScreen' class='page'  @onResultSeen='onResultSeen' :result='quizResult' />
    <Contact v-if='isOnContactScreen' class='page' @onContactMe='onWantToBeContacted' :positive='isQuizzGood'/>
    <div v-if='! isOnWelcomeScreen'  class='button-restart' @click='restart'>Restart</div>
  </div>

</template>

<script>
import WelcomeView from './components/Welecome.vue';
import PersonalInfoView from './components/PersonalInfoView.vue';
import Quiz from './components/Quiz.vue';
import Result from './components/Result.vue';
import Contact from './components/Contact.vue';

// This import loads the firebase namespace along with all its type information.
import * as firebase from 'firebase/app';
import firebaseConfig from './conf/firebase'
// These imports load individual services into the firebase namespace.
import 'firebase/database';

const SCREEN_WELCOME = 'welcome';
const SCREEN_PERSO = 'perso';
const SCREEN_QUIZ = 'quiz';
const SCREEN_RESULTS = 'result';
const SCREEN_CONTACT = 'contact';


var firebaseDB = firebase.initializeApp(firebaseConfig).database();


export default {
  name: 'app',
  components: {
    WelcomeView,
    PersonalInfoView,
    Quiz,
    Result,
    Contact
  },

  data() { 
    return {
      currentScreen: SCREEN_WELCOME,
      quizResult: {
        questionTaken: 0,
        correct: 0
      },
      user: {
        job_interest: '',
        first_name:'',
        last_name:'',
        email: '',
        phone: '',
        want_contact: false,
      }
    };
  },

  methods: {

    onJobSeclected(evt) {
      this.currentScreen = SCREEN_PERSO;
      this.user.job_interest = evt.job.job;
    },

    userInfoCompleted(evt) {
      this.user.first_name =  evt.user.firstName;
      this.user.last_name = evt.user.lastName;
      this.user.email = evt.user.email;
      this.user.phone = evt.user.phone;
      this.currentScreen = SCREEN_QUIZ;
    },

    onQuizDone(evt){
      this.quizResult.questionTaken = evt.taken
      this.quizResult.correct = evt.score
      this.currentScreen = SCREEN_RESULTS
    },

    onResultSeen(evt){
      this.currentScreen = SCREEN_CONTACT;
      setTimeout(() => {this.sendToFirebase();}, 10000);
    },
    
    onWantToBeContacted(evt) {
      this.user.want_contact = true;
    },

    sendToFirebase(){
        firebaseDB.ref('prospects/' ).push({
          quiz: this.quizResult,
          personal: this.user
        }).then(value => {
          this.resetData();
          this.currentScreen = SCREEN_WELCOME;
        });
    },

    onWantToBeContacted(){
      this.user.want_contact = true;
    },
  
    resetData() {
      this.user.job_interest= ''
      this.user.first_name = ''
      this.user.last_name = ''
      this.user.email = ''
      this.user.phone = ''
      this.user.want_contact = false;
      this.quizResult.questionTaken = 0
      this.quizResult.correct = 0
    },

    restart() {
      this.resetData()
      this.currentScreen = SCREEN_WELCOME;
    },
  },
  
  computed:{
    isOnWelcomeScreen() {
      return this.currentScreen == SCREEN_WELCOME;
    },

    isOnPersoScreen() {
      return this.currentScreen == SCREEN_PERSO;
    },

    isOnQuizScreen() {
      return this.currentScreen == SCREEN_QUIZ;
    },

    isOnResultScreen() {
      return this.currentScreen == SCREEN_RESULTS;
    },

    isOnContactScreen() {
      return this.currentScreen == SCREEN_CONTACT;
    },

    isQuizzGood() {
      if (this.quizResult.questionTaken == 0) {
        return false;
      } else {
        if (this.quizResult.correct / this.quizResult.questionTaken > 0.6) {
          return true;
        } else {
          return false;
        }
      }
    }
  }

};
</script>

<style lang="scss">
$red-scandiweb: #e04f4f;
$transition-duration: .5s;
$duration : 2s;

.fade-enter-active, .fade-leave-active {
  transition: opacity .5s;
}
.fade-enter, .fade-leave-to /* .fade-leave-active below version 2.1.8 */ {
  opacity: 0;
}

.slide-fade-enter {
  transition: all $transition-duration ease;
  opacity: 0;
}

.slide-fade-enter-to {
  opacity: 1;
}


body {
  margin: 0;
  padding: 0;
  background: $red-scandiweb;
}

.page {
  padding: 16px;
  margin: 64px auto; 
  width: 550px;
  background: rgba(255, 255, 255, 0.322);
}

#app {
  font-family: 'Avenir', Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-align: center;
  color: #2c3e50;
  overflow: hidden;
}

#logo svg{
  margin-top: 24px;
  width: 60%;
  fill: #fff;
}

.but {
    margin-top: 16px;
    line-height: 56px;
    background: white;
    color: #000;
    width: 100%;
    height: 56px;
    font-weight: 800;
    font-size: 22px;
    letter-spacing: 1.5px;
    border-radius: 8px;
}

.button-restart {
  cursor: pointer;
  background-color: #ffffff83;
  color: #2c3e50;
  border-radius: 12px;
  max-width: 256px;
  height: 48px;
  line-height: 48px;
  margin: 0 auto;
}
</style>
